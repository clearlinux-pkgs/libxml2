From https://bugzilla.gnome.org/show_bug.cgi?id=772726

```
Hum, the patch is just trying to address the problem at another layer.
But I don't understand why the existing test is not catching it,
it seems to imply that within xmlsec1 context we have either
XML_PARSE_DTDLOAD or XML_PARSE_DTDATTR or ctxt->replaceEntities
or ctxt->validate. All of them asks for loading of DTDs and then
fetching the external subset.
 I wonder if we aren't activating XML_PARSE_DTDATTR to have the
 defaulted attributes from the DTD included in the canonical form,
 in which case I don't see how we could both prevent fetching external
 subset and be compliant with the spec. I think it's worth investigating
 because that mean the patch leads to a regression from an XML Sec POV.

   Could you clarify ?

       thanks,

       Daniel
```

--- libxml2-2.9.4/parserInternals.c-	2016-11-17 09:54:07.014775411 -0800
+++ libxml2-2.9.4/parserInternals.c	2016-11-17 10:00:29.027286402 -0800
@@ -1438,6 +1438,11 @@
                 break;
             case XML_EXTERNAL_GENERAL_PARSED_ENTITY:
             case XML_EXTERNAL_PARAMETER_ENTITY:
+                if (((ctxt->options & XML_PARSE_NOENT) == 0) &&
+                    ((ctxt->options & XML_PARSE_DTDVALID) == 0)) {
+                    xmlErrInternal(ctxt, "xmlNewEntityInputStream will not read content for external entity\n",
+                                   NULL);
+                }
 		return(xmlLoadExternalEntity((char *) entity->URI,
 		       (char *) entity->ExternalID, ctxt));
             case XML_INTERNAL_GENERAL_ENTITY:
